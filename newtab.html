<!DOCTYPE html>
<html>
<head>
  <title>新标签页</title>
  <meta charset="UTF-8">
  <link rel="stylesheet" href="css/base.css">
  <link rel="stylesheet" href="css/components.css">
  <link rel="stylesheet" href="css/pages.css">
  <link rel="stylesheet" href="css/animations.css">
</head>
<body>
  <div id="bgContainer"></div>
  <div id="bgOverlay"></div>
  <div class="compass-bg" style="display: none;">
    <div class="compass-clock" id="compassTemplate">
      <div class="compass-ring compass-hours" id="compassHours"></div>
      <div class="compass-ring compass-minutes" id="compassMinutes"></div>
      <div class="compass-ring compass-seconds" id="compassSeconds"></div>
      <div class="compass-center">
        <div class="compass-date" id="compassDate">1/1</div>
        <div class="compass-weekday" id="compassWeekday">周一</div>
      </div>
    </div>
  </div>
  <div class="page-indicator">
    <div class="page-dot active" data-page="0"></div>
    <div class="page-dot" data-page="1"></div>
    <div class="page-dot" data-page="2"></div>
  </div>

  <div class="slide-trigger-zone left" id="leftTriggerZone" style="display: none;">
    <button class="slide-btn left" id="slideLeftBtn">
      <span class="arrow">←</span>
    </button>
    <span class="slide-hint left">返回首页</span>
  </div>

  <div class="slide-trigger-zone right" id="rightTriggerZone" style="display: flex;">
    <span class="slide-hint right">便签</span>
  </div>

  <div class="main-page" id="mainPage">
    <div class="container">
      <div class="bookmarks-section">
        <div class="bookmarks-section-title">
          <span>常用网站</span>
          <span class="bookmarks-count" id="topBookmarksCount"></span>
        </div>
        <div class="bookmarks-grid" id="topBookmarksGrid"></div>
      </div>
      <div class="bookmarks-section more-bookmarks-section" id="moreBookmarksSection">
        <div class="bookmarks-section-title">
          <span>更多网站</span>
          <span class="bookmarks-count" id="moreBookmarksCount"></span>
        </div>
        <div class="bookmarks-grid more-grid" id="moreBookmarksGrid"></div>
      </div>
    </div>
  </div>

  <div class="notes-page" id="notesPage">
    <div class="notes-page-header">
      <button class="back-btn" id="backBtn">← 返回</button>
      <h2>便签</h2>
      <button class="add-note-btn" id="addNoteBtn">+ 新建</button>
    </div>
    <div class="notes-container">
      <div class="notes-grid" id="notesGrid">
      </div>
    </div>
  </div>

  <div class="stats-page" id="statsPage">
    <div class="stats-page-header">
      <button class="back-btn" id="statsBackBtn">← 返回</button>
      <h2>📊 访问统计</h2>
    </div>
    <div class="stats-container">
      <div class="stats-summary">
        <div class="stats-summary-item">
          <div class="stats-summary-number" id="totalVisitsPage">0</div>
          <div class="stats-summary-label">总访问次数</div>
        </div>
        <div class="stats-summary-item">
          <div class="stats-summary-number" id="totalBookmarksPage">0</div>
          <div class="stats-summary-label">网站总数</div>
        </div>
        <div class="stats-summary-item">
          <div class="stats-summary-number" id="mostVisitedPage">-</div>
          <div class="stats-summary-label">最常访问</div>
        </div>
      </div>
      <div class="stats-list" id="statsListPage">
      </div>
    </div>
  </div>

  <div class="dialog" id="editDialog">
    <div class="dialog-content">
      <form id="editForm">
        <h3>编辑网站</h3>
        <div class="form-group"><label>名称</label><input type="text" id="editName" required></div>
        <div class="form-group"><label>网址</label><input type="url" id="editUrl" required></div>
        <div class="form-group">
          <label>图标URL</label>
          <input type="text" id="editIcon" placeholder="输入图标URL或使用搜索">
        </div>
        <div class="form-group">
          <label>搜索LOGO</label>
          <div class="search-input-group">
            <input type="text" id="logoSearchInput" placeholder="输入网站域名搜索LOGO">
            <button type="button" class="dialog-btn" id="logoSearchBtn" style="background:rgba(102,126,234,1);">搜索</button>
          </div>
          <div id="logoSearchResults"></div>
        </div>
        <div class="dialog-buttons">
          <button type="button" class="dialog-btn cancel" id="cancelEditBtn">取消</button>
          <button type="submit" class="dialog-btn primary">保存</button>
        </div>
      </form>
    </div>
  </div>

  <div class="dialog" id="addBookmarkDialog">
    <div class="dialog-content">
      <h3>添加网站</h3>
      <div class="add-options">
        <button type="button" class="add-option" id="manualAddBtn">✏️ 手动输入</button>
        <button type="button" class="add-option" id="historyAddBtn">📜 从历史导入</button>
        <button type="button" class="add-option" id="bookmarkAddBtn">🔖 从书签导入</button>
        <button type="button" class="add-option" id="openTabsAddBtn">📑 从标签页导入</button>
      </div>
      <form id="manualAddForm" style="display:none;">
        <div class="form-group"><label>名称</label><input type="text" id="manualName" required></div>
        <div class="form-group"><label>网址</label><input type="url" id="manualUrl" placeholder="https://" required></div>
        <div class="dialog-buttons">
          <button type="button" class="dialog-btn cancel" id="cancelManualAddBtn">取消</button>
          <button type="submit" class="dialog-btn primary">添加</button>
        </div>
      </form>
      <div id="historyItemsContainer" class="import-list" style="display:none;"></div>
      <div id="bookmarkItemsContainer" class="import-list" style="display:none;"></div>
      <div id="openTabsContainer" class="import-list" style="display:none;"></div>
    </div>
  </div>

  <div class="dialog" id="settingsDialog">
    <div class="dialog-content">
      <h3>设置</h3>
      <div class="settings-section">
        <h4>个性化背景</h4>
        <div class="form-group">
          <label>背景模式</label>
          <div class="sort-buttons">
            <button type="button" class="dialog-btn bg-mode-btn" data-mode="default">默认深色</button>
            <button type="button" class="dialog-btn bg-mode-btn" data-mode="bing">必应每日</button>
            <button type="button" class="dialog-btn bg-mode-btn" data-mode="custom">自定义图片</button>
          </div>
        </div>
        <div class="form-group" id="bgCustomUrlGroup" style="display: none;">
          <label>图片链接 (URL)</label>
          <input type="url" id="bgCustomUrl" placeholder="https://example.com/image.jpg">
        </div>
        <div class="form-group">
          <label>遮罩浓度 (0-100%)</label>
          <div style="display: flex; align-items: center; gap: 10px;">
            <input type="range" id="bgOverlayOpacity" min="0" max="100" value="40" style="flex: 1;">
            <span id="bgOverlayValue">40%</span>
          </div>
        </div>
      </div>
      <div class="settings-section">
        <div class="size-buttons">
          <button type="button" class="dialog-btn size-button" data-size="small">小</button>
          <button type="button" class="dialog-btn size-button" data-size="medium">中</button>
          <button type="button" class="dialog-btn size-button" data-size="large">大</button>
        </div>
      </div>
      <div class="settings-section">
        <h4>卡片形状</h4>
        <div class="shape-buttons">
          <button type="button" class="dialog-btn shape-button" data-shape="square">方形</button>
          <button type="button" class="dialog-btn shape-button" data-shape="round">圆形</button>
        </div>
      </div>
      <div class="settings-section">
        <h4>排序方式</h4>
        <div class="sort-buttons">
          <button type="button" class="dialog-btn sort-button" data-sort="default">默认</button>
          <button type="button" class="dialog-btn sort-button" data-sort="visits">访问次数</button>
          <button type="button" class="dialog-btn sort-button" data-sort="recent">最近访问</button>
          <button type="button" class="dialog-btn sort-button" data-sort="name">名称</button>
        </div>
      </div>
      <div class="settings-section">
        <h4>数据备份 & 恢复</h4>
        <div class="dialog-buttons" style="justify-content: flex-start; margin-bottom: 15px;">
          <button type="button" class="dialog-btn" id="createBackupBtn" style="background:rgba(102,126,234,1);">➕ 创建新备份</button>
        </div>
        <div id="backupList" style="max-height: 200px; overflow-y: auto; border: 1px solid rgba(0,0,0,0.1); border-radius: 8px; background: rgba(255,255,255,0.5);">
          <div style="padding: 15px; text-align: center; color: #666; font-size: 0.85rem;">正在加载备份...</div>
        </div>
      </div>
      <div class="settings-section">
        <h4>数据管理</h4>
        <div class="dialog-buttons" style="justify-content: flex-start;">
          <button type="button" class="dialog-btn" style="background:rgba(76,175,80,1);">导出数据</button>
          <input type="file" id="importFileInput" accept=".json" style="display:none;">
          <button type="button" class="dialog-btn" style="background:rgba(255,152,0,1);">导入数据</button>
        </div>
      </div>
      <div class="settings-section">
        <h4>WebDAV同步</h4>
        <div id="webdavStatus" style="margin-bottom: 10px; font-size: 0.85rem; color: #666;">
          未配置
        </div>
        <div class="dialog-buttons" style="justify-content: flex-start; flex-wrap: wrap; gap: 8px;">
          <button type="button" class="dialog-btn" id="webdavConfigBtn" style="background:rgba(102,126,234,1);">配置</button>
          <button type="button" class="dialog-btn" id="webdavUploadBtn" style="background:rgba(76,175,80,1); display:none;">上传到云端</button>
          <button type="button" class="dialog-btn" id="webdavDownloadBtn" style="background:rgba(255,152,0,1); display:none;">从云端下载</button>
          <button type="button" class="dialog-btn" id="webdavDisconnectBtn" style="background:rgba(244,67,54,1); display:none;">断开连接</button>
        </div>
      </div>
      <div class="settings-section" id="autoSyncSection" style="display:none;">
        <h4>自动同步</h4>
        <div id="autoSyncStatus" style="margin-bottom: 10px; font-size: 0.85rem; color: #666;">
          未启用
        </div>
        <div class="form-group" style="margin-bottom: 10px;">
          <label style="display: flex; align-items: center; gap: 8px; cursor: pointer;">
            <input type="checkbox" id="autoSyncEnabled" style="width: auto;">
            <span>启用自动同步</span>
          </label>
        </div>
        <div class="form-group" style="margin-bottom: 10px;">
          <label>同步间隔（分钟）</label>
          <input type="number" id="autoSyncInterval" value="30" min="5" max="1440" style="width: 100px;">
        </div>
        <div class="form-group" style="margin-bottom: 10px;">
          <label style="display: flex; align-items: center; gap: 8px; cursor: pointer;">
            <input type="checkbox" id="autoSyncOnStart" style="width: auto;">
            <span>启动时同步</span>
          </label>
        </div>
        <div class="dialog-buttons" style="justify-content: flex-start;">
          <button type="button" class="dialog-btn" id="saveAutoSyncBtn" style="background:rgba(102,126,234,1);">保存设置</button>
        </div>
      </div>
      <div class="dialog-buttons">
        <button type="button" class="dialog-btn primary" id="cancelSettingsBtn">关闭</button>
      </div>
    </div>
  </div>

  <div class="dialog" id="webdavConfigDialog">
    <div class="dialog-content">
      <h3>WebDAV配置</h3>
      <form id="webdavConfigForm">
        <div class="form-group">
          <label>服务器地址</label>
          <input type="url" id="webdavServerUrl" placeholder="https://example.com/dav" required>
        </div>
        <div class="form-group">
          <label>用户名</label>
          <input type="text" id="webdavUsername" placeholder="用户名" required>
        </div>
        <div class="form-group">
          <label>密码</label>
          <input type="password" id="webdavPassword" placeholder="密码" required>
        </div>
        <div class="form-group">
          <label>同步路径（可选）</label>
          <input type="text" id="webdavSyncPath" placeholder="/newtab-sync/" value="/newtab-sync/">
        </div>
        <div id="webdavTestResult" style="margin-bottom: 15px; font-size: 0.85rem;"></div>
        <div class="dialog-buttons">
          <button type="button" class="dialog-btn cancel" id="cancelWebdavConfigBtn">取消</button>
          <button type="button" class="dialog-btn" id="testWebdavBtn" style="background:rgba(102,126,234,1);">测试连接</button>
          <button type="submit" class="dialog-btn primary">保存</button>
        </div>
      </form>
    </div>
  </div>

  <div class="context-menu" id="contextMenu">
    <div class="context-menu-item" data-action="currentTab"><span>📖</span><span>在此标签页打开</span></div>
    <div class="context-menu-item" data-action="newTab"><span>➡️</span><span>在新标签页中打开</span></div>
    <div class="context-menu-item" data-action="edit"><span>✏️</span><span>编辑网站信息</span></div>
    <div class="context-menu-item" data-action="delete"><span>🗑️</span><span>删除书签</span></div>
  </div>

  <button class="settings-button" id="settingsButton" title="设置">⚙️</button>
  <button class="stats-entry-button" id="statsEntryButton" title="访问统计">📊</button>
  <button class="notes-entry-button" id="notesEntryButton" title="便签">📝</button>
  <script type="module" src="js/main.js"></script>
</body>
</html>
